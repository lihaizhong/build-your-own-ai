# periodic_model.py 预测模型逻辑说明

本说明文档详细介绍了 `periodic_model.py` 脚本的建模与预测流程。

## 1. 数据读取与预处理
- **数据来源**：读取 `user_balance_table.csv`，包含每日申购与赎回金额。
- **时间筛选**：仅保留 2014-03-01 至 2014-08-31 这段时间的数据，作为模型训练集。
- **日期格式转换**：将 `report_date` 字段转换为 pandas 的日期类型，便于后续特征提取。
- **日聚合**：按天聚合，得到每日的总申购金额（`total_purchase_amt`）和总赎回金额（`total_redeem_amt`）。

## 2. 特征工程
- **周期性特征提取**：
  - `weekday`：提取每一天是星期几（0=周一，6=周日）。
  - `day_of_month`：提取每一天是当月的第几天（1~31）。
- 这两个特征反映了金融数据常见的“周周期”和“月内周期”规律。

## 3. 模型构建
- **建模方法**：
  - 使用 statsmodels 的 OLS（最小二乘法线性回归）模型。
  - 公式：
    - 申购金额：`total_purchase_amt ~ C(weekday) + C(day_of_month)`
    - 赎回金额：`total_redeem_amt ~ C(weekday) + C(day_of_month)`
  - 其中 `C()` 表示将变量视为分类变量（即每个星期几、每个日历日都有独立的影响系数）。
- **建模目的**：
  - 学习历史数据中“星期几效应”和“月内日期效应”对申购/赎回金额的叠加影响。

## 4. 未来数据预测
- **预测区间**：生成 2014-09-01 至 2014-09-30 共30天的日期。
- **特征提取**：对未来日期同样提取 `weekday` 和 `day_of_month`。
- **模型预测**：
  - 用训练好的模型分别对未来30天的申购和赎回金额进行预测。
  - 预测值如有负数，自动截断为0。

## 5. 结果输出
- **输出内容**：
  - `report_date`：预测日期（格式为 yyyymmdd）
  - `purchase`：预测申购金额
  - `redeem`：预测赎回金额
- **保存格式**：
  - 结果保存为 `periodic_forecast_201409.csv`，编码为 UTF-8-SIG，便于中文环境下 Excel 打开。

## 6. 适用场景与优缺点
- **适用场景**：
  - 适合有明显周期性（如周、月内效应）的金融时间序列数据。
- **优点**：
  - 简单直观，能捕捉周期性规律。
  - 解释性强，可分析每个周期因子的影响。
- **局限**：
  - 未考虑趋势、节假日等其他影响因素。
  - 仅能拟合周期性叠加，无法捕捉复杂的非线性关系。

---
如需进一步改进模型，可引入更多特征（如节假日、宏观经济指标等），或采用更复杂的时序建模方法（如 ARIMA、LSTM 等）。 