# Function Calling与协作

---

Function Call 的作用

- 扩展模型能力
- 结构化输出
- 动态决策流程

> Function Call 是大模型与真实世界交互的“桥梁”，从语言理解 => 具体行动

| 维度 | Function Calling | MCP |
| --- | --- | --- |
| 定位 | 模型厂商私有接口（如OpenAI, Qwen） | 开放协议（类似HTTP/USB-C） |
| 扩展性 | 需为每个模型单独适配 | 一次开发，多模型兼容 |
| 复杂性 | 适合简单、单次调用任务 | 支持多轮对话、复杂上下文管理 |
| 生态依赖 | 依赖特定模型（如GPT-4） | 跨模型、跨平台（如Claude、Cursor） |
| 安全性 | 依赖云端API 密钥 | 支持本地化数据控制 |

---

如何在 exec_sql 查询数据之后，将数据进行可视化图表呈现？

- 方法一：编写新的函数 plot_data，传入 Markdown 的图表，进行可视化
- 方法二：在原有 exec_sql 函数基础上，增加 plot_data 的功能，返回结果包括：
  - 数据表 Markdown
  - 可视化图表 png

方法一的问题是什么？

1. Markdown 传参可能更大，另外要绘制的 x，y 参数也不一定能传递准确
2. 编写 Markdown 绘图有一定的难度，也需要先将 Markdown 转化为 df（dataframe 格式），然后再进行绘制
3. 在 qwen-agent 中，很难保存中间的 df，不同用户实例之间的维护成本可能较高

所以，推荐采用方法二

---

Function Call 是否需要微调？

通常大模型具备 Function Call 的能力，但有时候针对特定的 Function Call 理解和提参能力不强 => 可以微调

Function Call 的微调目标，是教会模型下面两件事：

- 判断是否需要调用函数（比如“查天气”需要，而“写首诗”不需要）。
- 正确提取参数并生成格式化的调用指令（比如转成 JSON）。

---

Function Call 微调的步骤是怎样的？

1. 准备数据
2. 模型训练

---

Function Call 微调的关键点：

- **数据质量**：需要覆盖各种场景（需要/不需要调用、参数变化等）。
- **函数描述要清晰**：模型靠描述理解函数用途。
- **避免误触发**：加入足够多“无需调用”的样本，防止模型滥用函数。

---
