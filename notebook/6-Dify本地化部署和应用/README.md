# Dify本地化部署和应用

## Dify开发平台

Dify是一个开源的 LLM 应用开发平台。提供从 Agent 构建到AI workflow编排、RAG检索、模型管理等能力，轻松构建和运营生成式AI原生应用。

---
Dify提供五种应用类型：

- **聊天助手**：基于 LLM 构建对话式交互的助手。
- **文本生成应用**：面向文本生成类任务的助手，比如：撰写故事、文本分类、翻译等。
- **Agent**：能够分解任务、推理思考、调用工具的对话式智能助手。
- **对话流（Chatflow）**：适用于设计复杂流程的多轮对话场景，支持记忆功能并能进行动态应用编排。
- **工作流（Workflow）**：适用于自动化、批处理等单论生成类任务的场景的应用编排方式，单项生成结果。

---

## Dify部署与使用

Dify 的本地化部署主要有两种方式：[Docker Compose部署（推荐）](https://docs.dify.ai/zh-hans/getting-started/install-self-hosted/docker-compose)和 源代码部署。

---

### Docker

一个开源的应用容器引擎，可以将应用及其所有依赖打包到一个可移植的容器中 => 保证了应用在任何环境中都能以相同的方式运行，简化了部署和管理。

---

### Docker Compose

一个用于定义和运行多容器 Docker 应用程序的工具。通过 YAML 文件配置应用服务，然后使用一条命令就能创建并启动所有服务。

---

## Dify的应用

在 Dify 平台中，Chatflow 和 Workflow 是两种核心的应用编排工具，它们分别服务于不同类型的 AI应用场景。

- Chatflow（对话流）：**专为构建交互式、多轮对话的AI应用而设计。** 它更侧重于模拟人类对话的模式，能够记忆上下文，并根据用户的输入进行多步骤的逻辑处理和回复。
- Workflow（工作流）：**主要面向自动化、批处理或单次任务执行的场景。** 它适合处理那些不需要实时对话交互，但可能涉及复杂数据处理、分析、内容生成或与其他系统集成的任务。

### 知识库

#### 分段标识

对于结构不佳的文本，上传前预设强分隔符（而非仅依赖回车），能大幅提升初始分段的语义完整性。

---

#### 长度与重叠的设置

最大长度需匹配模型处理窗口，有时小而精的分段（尤其问答型）优于大段落；重叠虽保留上下文但增加成本，常见平衡点是10%-20%。

---

#### 索引模式的思考

“高质量”模式理解复杂语义更优，适合专业内容，但模式切换成本高（需整个知识库重索引）

---

### Embedding模型选择

选定并索引后，若想更换 Embedding 模型，整个知识库需重新向量化，成本高。模型质量直接决定后续向量检索的语义理解上限。

---

### Rerank 是“精炼器”而非万能药

---
启动 Rerank 模型（如 gte-rerank）能显著提升相关性排序，但也增加检索延迟和计算成本。并非所有场景都追求极致精度，需权衡。

---

### Score 阔值的设定

Score 的选择因所选 Embedding 模型而异，不存在通用“最佳值”，需针对性调优。

---

### 全文检索的作用

它能精准命中向量检索可能遗漏的特定术语、代码片段或专有名词，是语义模糊匹配的有力补充。

---

### 混合检索的“融合艺术”

优势在于结合向量与全文，但效果好坏很大程度上取决于结果的“融合与重排序”策略。Dify支持权重调整，为用户提供了个性化调优手段。

---

## CASE：LLM联网搜索

![Pasted image 20250921210430.png](../../public/Pasted_Image_20250921210430.png)

---

## CASE：搭建古诗词工作流

![Pasted image 20250921213545.png](../../public/Pasted_Image_20250921213545.png)

---

## CASE：智能客服ChatFlow

![Pasted image 20250921223019.png](../../public/Pasted_Image_20250921223019.png)

---

## CASE：智能文档分析助手

![Pasted image 20250921230725.png](../../public/Pasted_Image_20250921230725.png)

---

## Coze API调用

![Pasted image 20250922214020.png](../../public/Pasted_Image_20250922214020.png)

---

## Dify API调用

![Pasted image 20250923000615.png](../../public/Pasted_Image_20250923000615.png)
