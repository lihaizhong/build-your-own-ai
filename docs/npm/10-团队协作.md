# 场景十：团队协作

## 场景描述

多人开发时的协作命令，包括链接包、团队管理、权限控制等。

## 涉及命令

### 1. npm link

**用途**: 本地链接包，用于开发和测试

**语法**:
```bash
npm link                        # 链接到全局
npm link <package>              # 从全局链接到项目
npm unlink <package>            # 取消链接
```

**示例**:
```bash
# 在包目录中
cd my-package
npm link

# 在使用包的项目中
cd my-project
npm link my-package

# 取消链接
npm unlink my-package
```

---

### 2. npm org

**用途**: 管理 npm 组织

**语法**:
```bash
npm org add <user> <org>        # 添加用户到组织
npm org rm <user> <org>         # 从组织移除用户
npm org ls <org>                # 列出组织成员
npm org set <org>               # 设置组织属性
```

**示例**:
```bash
# 添加用户到组织
npm org add username mycompany

# 列出组织成员
npm org ls mycompany

# 从组织移除用户
npm org rm username mycompany
```

---

### 3. npm team

**用途**: 管理组织团队

**语法**:
```bash
npm team create <team> <org>    # 创建团队
npm team add <user> <team>      # 添加用户到团队
npm team rm <user> <team>       # 从团队移除用户
npm team ls <team>              # 列出团队成员
npm team destroy <team>         # 删除团队
```

**示例**:
```bash
# 创建团队
npm team create developers mycompany

# 添加用户到团队
npm team add username developers

# 列出团队成员
npm team ls developers

# 从团队移除用户
npm team rm username developers

# 删除团队
npm team destroy developers
```

---

## 使用场景

### 场景 1: 本地开发链接

```bash
# 1. 在包目录中链接到全局
cd my-package
npm link

# 2. 在项目目录中链接包
cd my-project
npm link my-package

# 3. 开发和测试
# 4. 完成后取消链接
npm unlink my-package
```

### 场景 2: 组织协作

```bash
# 1. 创建组织（在 npm 网站上）
# https://www.npmjs.com/org/create

# 2. 添加成员
npm org add username mycompany

# 3. 查看组织成员
npm org ls mycompany
```

### 场景 3: 团队权限管理

```bash
# 1. 创建团队
npm team create developers mycompany
npm team create admins mycompany

# 2. 添加用户到团队
npm team add devuser developers
npm team add adminuser admins

# 3. 查看团队
npm team ls developers

# 4. 移除用户
npm team rm devuser developers
```

### 场景 4: 私有包协作

```bash
# 1. 创建作用域包
{
  "name": "@mycompany/my-package",
  "publishConfig": {
    "access": "restricted"
  }
}

# 2. 添加组织成员
npm org add username mycompany

# 3. 发布包
npm publish

# 4. 团队成员安装
npm install @mycompany/my-package
```

---

## 最佳实践

### 1. 使用本地链接开发

```bash
# 在包目录
cd my-package
npm link

# 在项目目录
cd my-project
npm link my-package

# 开发完成后
npm unlink my-package
```

### 2. 组织结构

```
mycompany (组织)
├── @mycompany/admins (管理员团队)
├── @mycompany/developers (开发团队)
└── @mycompany/testers (测试团队)
```

### 3. 权限管理

```bash
# 创建不同权限的团队
npm team create admins mycompany
npm team create developers mycompany
npm team create testers mycompany

# 分配权限
# 管理员：发布、删除
# 开发者：发布
# 测试者：只读
```

### 4. 使用私有包

```json
{
  "name": "@mycompany/my-package",
  "publishConfig": {
    "access": "restricted"
  },
  "repository": {
    "type": "git",
    "url": "https://github.com/mycompany/my-package.git"
  }
}
```

### 5. 文档化协作流程

```markdown
# 开发流程

1. 创建分支
2. 本地开发
3. 使用 npm link 测试
4. 提交 PR
5. 代码审查
6. 合并主分支
7. 发布版本
```

---

## 常见问题

### Q: npm link 不工作？

```bash
# 检查全局链接
npm ls -g --depth=0

# 重新链接
npm unlink my-package
npm link my-package

# 检查权限
sudo npm link
```

### Q: 如何管理组织包？

```bash
# 列出组织的包
# 在 npm 网站上查看
# https://www.npmjs.com/org/mycompany/packages

# 或使用 API
curl https://registry.npmjs.org/-/org/mycompany/packages
```

### Q: 如何设置团队权限？

```bash
# 在 npm 网站上设置
# https://www.npmjs.com/org/mycompany/teams

# 或使用 API
# 需要使用 npm API 或 CLI 工具
```

### Q: 如何处理多人开发的版本冲突？

```bash
# 使用语义化版本
npm version patch
npm version minor
npm version major

# 使用预发布版本
npm version prerelease
npm publish --tag beta
```

---

## 相关命令

| 命令 | 说明 |
|------|------|
| `npm link` | 本地链接包 |
| `npm unlink` | 取消链接 |
| `npm org` | 管理组织 |
| `npm team` | 管理团队 |
| `npm owner` | 管理包所有者 |
| `npm access` | 管理包访问权限 |

---

## 其他协作工具

### Git Hooks

```bash
# 安装 husky
npm install -D husky

# 设置 pre-commit hook
npx husky install
npx husky add .husky/pre-commit "npm run lint"

# 设置 commit-msg hook
npx husky add .husky/commit-msg "npx commitlint --edit $1"
```

### 代码审查

```bash
# 使用 ESLint
npm install -D eslint
npm run lint

# 使用 Prettier
npm install -D prettier
npm run format
```

### CI/CD

```yaml
# GitHub Actions 示例
name: CI

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
        with:
          node-version: '16'
      - run: npm ci
      - run: npm run lint
      - run: npm test
```

---

## 团队协作流程

### 标准流程

```bash
# 1. 克隆项目
git clone https://github.com/mycompany/project.git

# 2. 安装依赖
npm ci

# 3. 创建分支
git checkout -b feature/new-feature

# 4. 开发
# 使用 npm link 测试本地包
npm link @mycompany/shared-package

# 5. 测试
npm test

# 6. 提交
git add .
git commit -m "feat: add new feature"

# 7. 推送
git push origin feature/new-feature

# 8. 创建 PR
# 9. 代码审查
# 10. 合并
```

---

*最后更新: 2026年2月11日*