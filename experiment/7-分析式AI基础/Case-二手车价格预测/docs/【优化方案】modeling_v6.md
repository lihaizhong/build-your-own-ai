# 【优化方案】modeling_v6

## 当前状况分析

- **当前线上MAE**: 670.8439
- **目标**: 500分

虽然V5模型已经将MAE从885.5629降低到670.8439，取得了显著进步，但距离500分的目标还有较大差距。通过V5分析发现，模型在以下方面仍有改进空间：

1. **特征工程**: V5模型的特征相对简单，缺少一些有效的交叉特征和统计特征
2. **模型参数**: V5模型使用了较为保守的参数设置，可能限制了模型的表达能力
3. **集成策略**: V5模型采用等权重集成，未充分利用各模型的优势
4. **校准方法**: V5模型的校准方法相对简单，可能无法充分修正预测偏差

## V6优化策略

### 1. 增强特征工程

#### 添加更多交叉特征
- power_km_ratio: 功率与公里数比值
- power_km_product: 功率与公里数乘积
- power_div_km: 调整后的功率与公里数比值

#### 添加统计特征
- v_mean: v_*特征的均值
- v_std: v_*特征的标准差
- v_max: v_*特征的最大值
- v_min: v_*特征的最小值

#### 添加时间序列特征
- km_per_year: 年行驶公里数
- log_kilometer: 公里数对数变换
- log_car_age: 车龄对数变换

### 2. 调整模型参数

#### LightGBM参数优化
- num_leaves: 20 (降低复杂度)
- max_depth: 5 (降低深度)
- min_data_in_leaf: 150 (增加最小样本数)
- feature_fraction: 0.7 (降低特征采样)
- bagging_fraction: 0.7 (降低数据采样)
- lambda_l1: 0.5 (增加L1正则化)
- lambda_l2: 0.5 (增加L2正则化)
- learning_rate: 0.05 (降低学习率)
- n_estimators: 150 (适度减少迭代次数)

#### XGBoost参数优化
- max_depth: 5
- learning_rate: 0.05
- subsample: 0.7
- colsample_bytree: 0.7
- reg_alpha: 0.5
- reg_lambda: 0.5
- n_estimators: 150

#### CatBoost参数优化
- depth: 5
- learning_rate: 0.05
- iterations: 150
- l2_leaf_reg: 0.5

### 3. 使用交叉验证优化模型训练

V6模型采用5折交叉验证训练，确保模型的稳定性和泛化能力：
- 每一折都独立训练模型并评估性能
- 通过交叉验证选择最优的模型参数
- 利用交叉验证结果指导集成策略

### 4. 高级集成方法

#### 基于性能的加权集成
根据不同模型在交叉验证中的表现分配权重：
- LightGBM: 50% (CV MAE: 716.86)
- XGBoost: 30% (CV MAE: 792.52)
- CatBoost: 20% (CV MAE: 896.48)

#### 分段集成
根据不同价格区间的特点使用不同的集成策略：
- 低价车 (<10K): 侧重LightGBM和XGBoost
- 高价车 (>=10K): 适当增加CatBoost权重

### 5. 高级校准方法

#### 分段校准
根据不同价格区间进行不同的校准：
- 低价车校准: 调整幅度30%
- 高价车校准: 调整幅度30%

#### 渐进式校准
- 第一阶段: 全局均值校准
- 第二阶段: 分段校准
- 第三阶段: 局部平滑校准

## 预期效果

通过实施以上优化措施，预期可以将MAE进一步降低到以下范围：
- **V6优化后**: 600-650
- **进一步优化**: 550-600
- **长期目标**: 500-550

## 实施计划

### 短期优化（已完成）
1. 增强特征工程，添加更多有效特征
2. 调整模型参数，增强泛化能力
3. 使用交叉验证优化模型训练
4. 实施高级集成和校准方法

### 中期优化（建议）
1. 使用贝叶斯优化寻找最优超参数
2. 实施更复杂的分段集成策略
3. 添加深度学习模型作为补充

### 长期优化（建议）
1. 实现动态权重分配机制
2. 使用Stacking集成方法
3. 引入注意力机制增强特征表达

## 风险控制

1. **避免过拟合**
   - 使用交叉验证评估模型性能
   - 采用适度的正则化参数
   - 通过早停机制防止过拟合

2. **确保稳定性**
   - 使用鲁棒的特征缩放方法
   - 采用分段校准避免过度调整
   - 通过集成方法提高预测稳定性

3. **防止性能下降**
   - 保留V5模型作为baseline
   - 逐步引入新特征和方法
   - 通过A/B测试验证改进效果

## 结论

V6版本通过增强特征工程、调整模型参数、使用交叉验证优化训练、实施高级集成和校准方法，有望将MAE从670.8439降低到600-650范围内。V6模型已经训练完成，预测结果保存在：
`/Users/lihaizhong/Documents/Project/build-your-own-x/build-your-own-ai/experiment/7-分析式AI基础/Case-二手车价格预测/prediction_result/modeling_v6_20251021_110156.csv`

建议提交该预测结果进行验证，根据线上表现进一步调整优化策略，向500分目标迈进。