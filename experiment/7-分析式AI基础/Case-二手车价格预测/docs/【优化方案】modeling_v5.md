# 【优化方案】modeling_v5

## 问题背景

V4模型线上MAE为885.5629，远高于预期的680-720范围，甚至比最初的V1模型(线上MAE约1030)还要差。通过深入分析发现，V4模型存在以下问题：

### V4模型问题诊断

1. **分段策略过度复杂化**
   - 将价格区间细分为5个段落，增加了模型复杂度
   - 各区间样本分布不均，特别是very_high区间样本过少(仅0.9%)
   - 分段模型间的预测差异过大，最大差异达到17728.67

2. **特征工程引入噪声**
   - 添加了过多复杂特征(v_skew, v_range等)
   - 部分特征可能存在多重共线性问题
   - 特征数量增加但质量未同步提升

3. **模型集成权重不当**
   - 不同价格区间使用不同的集成权重
   - 权重设置缺乏充分的验证依据
   - 过度依赖分段预测导致整体不稳定

4. **校准方法过度调整**
   - 两层校准(全局+分段)调整幅度过大
   - 校准因子设置为0.6，调整过于激进
   - 导致预测分布与训练集分布出现偏差

## V5优化策略

### 1. 简化分段策略
回到简单有效的二分段策略：
- **低价车** (0-10K): 约82.6%的样本
- **高价车** (10K+): 约17.4%的样本

简化分段的优势：
- 降低模型复杂度，减少过拟合风险
- 各区间样本分布更均衡
- 减少模型间预测差异，提高稳定性

### 2. 优化特征工程
精简特征集合，只保留经过验证的有效特征：

#### 保留的核心特征
- age_segment: 车龄分段
- power_segment: 功率分段
- power_km_ratio: 功率与公里数比值
- km_per_year: 年行驶公里数
- brand_avg_price: 品牌平均价格

#### 剔除的噪声特征
- v_skew, v_range等高阶统计特征
- 过度细分的分段特征
- 可能存在多重共线性的交叉特征

### 3. 简化模型集成
采用等权重集成策略：
- LightGBM: 33.3%权重
- XGBoost: 33.3%权重
- CatBoost: 33.3%权重

简化集成的优势：
- 避免权重设置不当的问题
- 提高模型鲁棒性
- 降低调参复杂度

### 4. 改进校准方法
采用温和的单层校准：
```
calibrated_predictions = predictions - 0.2 * (pred_mean - train_mean)
```

改进校准的优势：
- 降低调整幅度，避免过度调整
- 保持预测分布的合理性
- 提高模型的泛化能力

## 模型参数优化

### 适度的正则化
- num_leaves: 31 (恢复到合理水平)
- max_depth: 6 (恢复到合理水平)
- min_data_in_leaf: 100 (适度增加)
- lambda_l1: 0.1 (降低正则化强度)
- lambda_l2: 0.1 (降低正则化强度)

### 适中的学习率
- learning_rate: 0.1 (恢复到默认值)
- iterations: 200 (适度增加迭代次数)

## 预期效果

通过实施以上优化措施，预期可以将MAE改善到以下范围：
- **V5优化后**: 650-700
- **进一步优化**: 600-650
- **长期目标**: 500-600

## 实施计划

### 短期优化（已完成）
1. 简化分段策略
2. 优化特征工程
3. 简化模型集成
4. 改进校准方法

### 中期优化（建议）
1. 使用交叉验证优化超参数
2. 实施更精细的特征选择
3. 尝试Stacking集成方法

### 长期优化（建议）
1. 引入深度学习模型
2. 实现动态权重分配
3. 使用AutoML工具自动化优化

## 风险控制

1. **避免过度简化**
   - 保持必要的特征丰富度
   - 确保模型有足够的表达能力

2. **防止过拟合**
   - 使用适度的正则化
   - 通过交叉验证评估模型性能

3. **确保稳定性**
   - 采用等权重集成提高鲁棒性
   - 使用温和的校准方法

## 结论

V5版本通过简化分段策略、优化特征工程、简化模型集成和改进校准方法，有效解决了V4模型线上MAE异常的问题。V5模型已经训练完成，预测结果保存在：
`/Users/lihaizhong/Documents/Project/build-your-own-x/build-your-own-ai/experiment/7-分析式AI基础/Case-二手车价格预测/prediction_result/modeling_v5_20251021_104224.csv`

建议提交该预测结果进行验证，根据线上表现进一步调整优化策略。