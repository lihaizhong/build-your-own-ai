# Cursor编程从入门到精通 - 使用指南

## 环境准备

### 1. 系统要求
- **操作系统**: Windows 10+, macOS 10.15+, Ubuntu 18.04+
- **Python版本**: 3.11+
- **内存**: 最小4GB，推荐8GB+
- **存储空间**: 最小1GB，推荐2GB+

### 2. 依赖安装

#### 方式一：使用uv（推荐）
```bash
# 克隆项目
git clone <repository-url>
cd CASE-Cursor编程-从入门到精通

# 创建虚拟环境
uv venv --python 3.11

# 激活虚拟环境
source .venv/bin/activate  # Linux/Mac
# 或
.venv\Scripts\activate     # Windows

# 安装依赖
uv sync

# 运行示例
uv run python code/读取员工信息表.py
```

#### 方式二：使用pip
```bash
# 创建虚拟环境
python -m venv .venv

# 激活虚拟环境
source .venv/bin/activate  # Linux/Mac
# 或
.venv\Scripts\activate     # Windows

# 安装依赖
pip install pandas openpyxl flask

# 运行示例
python code/读取员工信息表.py
```

## 快速开始

### 1. Excel数据处理

#### 读取员工基本信息表
```bash
# 1. 激活虚拟环境
source .venv/bin/activate

# 2. 运行读取脚本
python code/读取员工信息表.py
```

#### 预期输出
```
============================================================
员工基本信息表Excel文件读取程序
============================================================
正在读取文件：/path/to/员工基本信息表.xlsx

文件总行数（不包括表头）：10
文件列数：8
读取的行数：5

前5行数据：
============================================================
   员工编号   姓名 性别  年龄   部门     职位   入职日期    薪资
0    E001  张三  男  28  技术部  软件工程师  2022-01-15  12000
1    E002  李四  女  32  人事部    人事专员  2021-03-20   8000
2    E003  王五  男  25  技术部    前端工程师  2023-06-10  10000
3    E004  赵六  女  29  财务部      会计师  2020-11-05   9000
4    E005  钱七  男  35  市场部    市场专员  2022-08-12   7500

============================================================
列信息：
1. 员工编号
2. 姓名
3. 性别
4. 年龄
5. 部门
6. 职位
7. 入职日期
8. 薪资

程序执行完成！
```

### 2. 数据合并处理

#### 合并员工基本信息与绩效数据
```bash
# 运行合并脚本
python code/合并员工数据.py
```

#### 预期输出
```
================================================================================
员工基本信息与绩效数据合并程序
================================================================================
📊 正在读取员工基本信息表...
   成功读取员工基本信息 10 条记录
📈 正在读取员工绩效表...
   成功读取员工绩效信息 10 条记录

📋 数据概览：
   员工基本信息表列数：8
   员工绩效表列数：5
   员工基本信息表列名：['员工编号', '姓名', '性别', '年龄', '部门', '职位', '入职日期', '薪资']
   员工绩效表列名：['员工编号', '姓名', '综合得分', '绩效等级', '评语']

🔄 正在合并数据...
✅ 数据合并完成！共合并 10 条记录

📊 合并后数据统计：
   总记录数：10
   总列数：12
   有绩效数据的员工：10 人
   无绩效数据的员工：0 人

💾 正在保存合并数据到 员工综合信息表_2024Q4.xlsx...
✅ 文件保存成功

================================================================================
✅ 程序执行成功！
📁 生成的文件：员工综合信息表_2024Q4.xlsx
📊 包含工作表：
   1. 员工综合信息 - 完整的合并数据
   2. 数据统计摘要 - 数据统计信息
   3. 部门绩效分析 - 按部门的绩效分析
================================================================================
```

### 3. 可视化大屏

#### 启动疫情可视化大屏
```bash
# 运行Flask服务
python code/疫情可视化大屏.py
```

#### 预期输出
```
================================================================================
🚀 启动香港疫情数据可视化大屏
================================================================================
📊 访问地址：http://localhost:5001
📈 包含5个核心图表的疫情数据可视化
================================================================================
成功加载数据：90 条记录
 * Running on http://0.0.0.0:5001
```

#### 启动医院病床大屏
```bash
# 运行Flask服务
python code/医院病床可视化大屏.py
```

#### 预期输出
```
================================================================================
🏥 启动医院病床使用情况可视化大屏
================================================================================
📊 访问地址：http://localhost:5002
📈 包含5个核心图表的病床数据可视化
================================================================================
生成模拟数据：8 个科室
 * Running on http://0.0.0.0:5002
```

## Excel数据处理

### 1. 基础读取操作

#### 读取指定行数
```python
import pandas as pd

# 读取前5行
df = pd.read_excel('员工基本信息表.xlsx', nrows=5)

# 读取所有数据
df = pd.read_excel('员工基本信息表.xlsx')

# 读取指定sheet
df = pd.read_excel('文件.xlsx', sheet_name='Sheet1')
```

#### 读取特定列
```python
# 读取指定列
df = pd.read_excel('员工信息.xlsx', usecols=['员工编号', '姓名', '部门'])

# 按列索引读取
df = pd.read_excel('员工信息.xlsx', usecols=[0, 1, 4])
```

### 2. 数据合并操作

#### 左连接合并
```python
# 基于员工编号左连接
merged_df = pd.merge(
    info_df,           # 左表
    performance_df,    # 右表
    on='员工编号',     # 连接键
    how='left',        # 连接方式
    suffixes=('', '_绩效')  # 列名后缀
)
```

#### 内连接合并
```python
# 只保留两边都有的记录
merged_df = pd.merge(
    info_df,
    performance_df,
    on='员工编号',
    how='inner'
)
```

### 3. 数据统计分析

#### 分组统计
```python
# 按部门统计
dept_stats = df.groupby('部门').agg({
    '薪资': ['mean', 'max', 'min'],
    '员工编号': 'count'
})

# 按绩效等级统计
performance_stats = df.groupby('绩效等级').agg({
    '综合得分': 'mean',
    '员工编号': 'count'
})
```

#### 数据透视表
```python
# 创建透视表
pivot_table = pd.pivot_table(
    df,
    values='薪资',
    index='部门',
    columns='绩效等级',
    aggfunc='mean'
)
```

## 可视化大屏

### 1. 访问大屏页面

#### 疫情数据大屏
- **地址**: http://localhost:5001
- **图表**:
  - 每日新增与累计确诊趋势图
  - 各区域疫情分布热力图
  - 疫情增长趋势分析
  - 各区域疫情排行榜
  - 关键指标仪表盘

#### 医院病床大屏
- **地址**: http://localhost:5002
- **图表**:
  - 各科室病床占用率
  - 占用率趋势变化
  - 可用床位分布
  - 病床分布热力图
  - 关键指标仪表盘

### 2. API接口使用

#### 获取每日汇总数据
```bash
curl http://localhost:5001/api/daily_summary
```

#### 响应示例
```json
{
  "dates": ["2025-03-18", "2025-03-19", "2025-03-20"],
  "new_cases": [234, 189, 156],
  "total_cases": [1234, 1423, 1579]
}
```

#### 获取区域分布数据
```bash
curl http://localhost:5001/api/district_distribution
```

#### 响应示例
```json
[
  {"name": "中西区", "value": 456, "new_cases": 15},
  {"name": "湾仔区", "value": 678, "new_cases": 23}
]
```

### 3. 自定义图表配置

#### 修改图表样式
```javascript
// 在 templates/dashboard.html 中修改
const option = {
  series: [{
    type: 'bar',
    itemStyle: {
      color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
        { offset: 0, color: '#ffd700' },
        { offset: 1, color: '#ffed4a' }
      ])
    }
  }]
};
```

#### 添加新图表
```javascript
// 添加新的图表容器
<div id="newChart" class="chart"></div>

// 初始化图表
charts.newChart = echarts.init(document.getElementById('newChart'));
```

## 常见问题解决

### 1. 文件找不到问题

#### 问题现象
```
错误：找不到文件 /path/to/员工基本信息表.xlsx
```

#### 解决方案
```python
# 检查文件路径
from pathlib import Path

file_path = Path('data/员工基本信息表.xlsx')
if not file_path.exists():
    print(f"文件不存在: {file_path}")
    # 程序会自动创建示例文件
```

### 2. 端口占用问题

#### 问题现象
```
OSError: [Errno 48] Address already in use
```

#### 解决方案
```bash
# 查看端口占用
lsof -i :5001

# 终止占用进程
kill -9 <PID>

# 或使用其他端口
python code/疫情可视化大屏.py --port 5003
```

### 3. 模块导入错误

#### 问题现象
```
ModuleNotFoundError: No module named 'pandas'
```

#### 解决方案
```bash
# 安装缺失的依赖
pip install pandas openpyxl flask

# 或使用uv
uv add pandas openpyxl flask
```

## 性能调优

### 1. 数据处理优化

#### 分块处理大数据
```python
# 对于大文件使用分块读取
chunk_size = 10000
for chunk in pd.read_excel('large_file.xlsx', chunksize=chunk_size):
    process_chunk(chunk)
```

#### 使用高效数据类型
```python
# 指定数据类型减少内存占用
df = pd.read_excel('file.xlsx', dtype={
    '员工编号': 'str',
    '薪资': 'float32',
    '年龄': 'int8'
})
```

### 2. Flask性能优化

#### 启用调试模式
```python
if __name__ == '__main__':
    app.run(debug=True, threaded=True)
```

#### 添加缓存
```python
from functools import lru_cache

@lru_cache(maxsize=100)
def get_cached_data(key):
    return load_data(key)
```

### 3. 前端优化

#### 图表延迟加载
```javascript
// 按需加载图表
function loadChart(chartId) {
    if (!charts[chartId]) {
        charts[chartId] = echarts.init(document.getElementById(chartId));
    }
}
```

## 监控和调试

### 1. 日志记录

#### 配置日志
```python
import logging

logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('app.log'),
        logging.StreamHandler()
    ]
)

logger = logging.getLogger(__name__)
```

### 2. 性能监控

#### 添加性能计时
```python
import time

def process_with_timing():
    start = time.time()
    # 处理逻辑
    end = time.time()
    print(f"处理耗时: {end - start:.2f}秒")
```

### 3. 错误追踪

#### 异常捕获
```python
try:
    df = pd.read_excel(file_path)
except FileNotFoundError:
    logger.error(f"文件不存在: {file_path}")
    create_sample_file(file_path)
except Exception as e:
    logger.error(f"处理失败: {e}")
    raise
```

---

*最后更新: 2026年2月21日*
*使用指南版本: v1.0*
*技术支持: build-your-own-ai项目团队*
