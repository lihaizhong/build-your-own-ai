# Cursor编程从入门到精通 - 技术架构

## 架构概览

Cursor编程从入门到精通项目采用分层架构设计，包含数据层、处理层、服务层和展示层四个核心层次，确保系统的可扩展性、可维护性和高性能。

```
┌─────────────────────────────────────────────────────────────┐
│                        展示层 (Presentation)                 │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │ ECharts图表 │  │ HTML/CSS/JS │  │   响应式布局设计    │  │
│  └─────────────┘  └─────────────┘  └─────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
                              ▲
                              │ HTTP/WebSocket
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                        服务层 (Service)                      │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │ Flask路由   │  │ RESTful API │  │   数据处理器实例    │  │
│  └─────────────┘  └─────────────┘  └─────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
                              ▲
                              │ 函数调用
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                        处理层 (Processing)                   │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │ 数据读取    │  │ 数据合并    │  │   数据分析统计      │  │
│  └─────────────┘  └─────────────┘  └─────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
                              ▲
                              │ 文件I/O
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                        数据层 (Data)                         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │ Excel文件   │  │ JSON文件    │  │   地图数据文件      │  │
│  └─────────────┘  └─────────────┘  └─────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

## 核心组件架构

### 1. 数据处理模块架构

```python
class DataProcessor:
    """
    数据处理基类
    核心功能模块：
    - Excel文件读取模块
    - 数据清洗模块
    - 数据合并模块
    - 数据分析统计模块
    """
    
    def __init__(self, data_dir: str = "data"):
        self.data_dir = Path(data_dir)
        self.user_data_dir = self.data_dir / "user_data"
        self.user_data_dir.mkdir(parents=True, exist_ok=True)
```

### 2. Flask Web服务架构

```python
class FlaskDataService:
    """
    Flask数据服务类
    核心功能模块：
    - 路由管理模块
    - API接口模块
    - 数据处理器集成
    - 模板渲染模块
    """
    
    def __init__(self, port: int = 5001):
        self.app = Flask(__name__)
        self.port = port
        self.data_processor = DataProcessor()
        self._setup_routes()
```

### 3. 数据处理流程

```
┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│   读取数据    │ ──▶ │   清洗数据    │ ──▶ │   处理数据    │
└──────────────┘     └──────────────┘     └──────────────┘
       │                    │                    │
       ▼                    ▼                    ▼
┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│  pandas读取  │     │  空值处理     │     │  合并/统计   │
│  Excel文件   │     │  类型转换     │     │  分组聚合    │
└──────────────┘     └──────────────┘     └──────────────┘
```

## 技术栈详解

### 1. 数据处理技术

#### pandas数据处理
```python
# Excel文件读取
df = pd.read_excel(file_path, nrows=5)

# 数据合并
merged_df = pd.merge(
    info_df, 
    performance_df, 
    on='员工编号', 
    how='left',
    suffixes=('', '_绩效')
)

# 数据统计
summary = df.groupby('部门').agg({
    '综合得分': ['count', 'mean', 'max', 'min']
})
```

**技术特点：**
- **高效处理**: 支持大规模数据处理
- **灵活操作**: 丰富的数据操作API
- **类型支持**: 支持多种数据类型

#### openpyxl文件操作
```python
# 使用ExcelWriter进行格式控制
with pd.ExcelWriter(merged_file, engine='openpyxl') as writer:
    merged_df.to_excel(writer, sheet_name='员工综合信息', index=False)
```

### 2. Flask Web框架

#### 路由设计
```python
@app.route('/')
def dashboard():
    """主页路由 - 显示可视化大屏"""
    return render_template('dashboard.html')

@app.route('/api/daily_summary')
def api_daily_summary():
    """每日汇总数据API"""
    data = data_processor.get_daily_summary()
    return jsonify(data)
```

**路由结构：**
| 路由 | 方法 | 功能 |
|------|------|------|
| `/` | GET | 主页面 |
| `/api/daily_summary` | GET | 每日汇总数据 |
| `/api/district_distribution` | GET | 区域分布数据 |
| `/api/trend_analysis` | GET | 趋势分析数据 |
| `/api/key_indicators` | GET | 关键指标数据 |

### 3. ECharts可视化

#### 图表类型
```javascript
// 地图可视化
series: [{
    name: '疫情分布',
    type: 'map',
    map: 'HongKong',
    data: mapData
}]

// 仪表盘
series: [{
    name: '关键指标',
    type: 'gauge',
    data: [{ value: 85, name: '恢复率' }]
}]

// 柱状图
series: [{
    name: '新增确诊',
    type: 'bar',
    data: dailyData
}]
```

**图表配置：**
- **主题样式**: 深色科技风格
- **响应式设计**: 自适应窗口大小
- **交互效果**: 悬浮提示、点击事件

### 4. 地图数据处理

#### GeoJSON格式
```json
{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {
        "name": "Central and Western",
        "chineseName": "中西区"
      },
      "geometry": {
        "type": "Polygon",
        "coordinates": [...]
      }
    }
  ]
}
```

**地图特性：**
- **区域映射**: 英文名与中文名对应
- **数据绑定**: 疫情数据与区域关联
- **视觉编码**: 颜色深浅表示数值大小

## 系统配置架构

### 1. 项目路径管理
```python
def get_project_path(*paths: str) -> Path:
    """获取项目路径的统一方法"""
    try:
        current_dir = Path(__file__).parent
        project_dir = current_dir.parent
        return project_dir.joinpath(*paths)
    except NameError:
        return Path.cwd().joinpath(*paths)
```

### 2. 目录结构
```
CASE-Cursor编程-从入门到精通/
├── code/                    # 代码文件
│   ├── 读取员工信息表.py
│   ├── 合并员工数据.py
│   └── 疫情可视化大屏.py
├── data/                    # 数据文件
│   ├── 员工基本信息表.xlsx
│   └── 香港各区疫情数据.xlsx
├── templates/               # 模板文件
│   ├── dashboard.html
│   └── hongkong.json
├── user_data/               # 用户数据（生成）
└── docs/                    # 文档
```

### 3. 配置管理
```python
# Flask配置
app.config['DEBUG'] = True
app.config['HOST'] = '0.0.0.0'
app.config['PORT'] = 5001

# 数据处理配置
DATA_CONFIG = {
    'chunk_size': 1000,      # 分块处理大小
    'encoding': 'utf-8',     # 文件编码
    'engine': 'openpyxl'     # Excel引擎
}
```

## 性能优化架构

### 1. 数据加载优化
```python
# 分块读取大数据
def read_large_excel(file_path, chunk_size=1000):
    for chunk in pd.read_excel(file_path, chunksize=chunk_size):
        process_chunk(chunk)

# 数据缓存
class DataCache:
    def __init__(self):
        self.cache = {}
    
    def get(self, key):
        return self.cache.get(key)
    
    def set(self, key, value):
        self.cache[key] = value
```

### 2. API性能优化
```python
# 数据预加载
data_processor = CovidDataProcessor()

# 响应压缩
@app.after_request
def after_request(response):
    response.headers['Cache-Control'] = 'public, max-age=300'
    return response
```

### 3. 前端优化
```javascript
// 图表懒加载
function initCharts() {
    Object.keys(chartConfigs).forEach(key => {
        charts[key] = echarts.init(document.getElementById(key));
    });
}

// 数据缓存
const dataCache = new Map();
async function loadData(url) {
    if (dataCache.has(url)) {
        return dataCache.get(url);
    }
    const data = await fetch(url).then(r => r.json());
    dataCache.set(url, data);
    return data;
}
```

## 安全架构

### 1. 数据安全
- **输入验证**: 检查文件格式和路径
- **路径安全**: 使用绝对路径，防止目录遍历
- **异常处理**: 完善的错误捕获机制

### 2. 访问控制
```python
# CORS配置
from flask_cors import CORS
CORS(app, resources={r"/api/*": {"origins": "*"}})

# 请求验证
@app.before_request
def validate_request():
    # 验证请求参数
    pass
```

### 3. 数据脱敏
```python
# 敏感数据处理
def mask_sensitive_data(df, columns):
    for col in columns:
        if col in df.columns:
            df[col] = df[col].apply(lambda x: '***' + str(x)[-4:])
    return df
```

## 扩展架构

### 1. 插件化设计
```python
class DataPlugin:
    """数据处理插件基类"""
    
    def load_data(self, source):
        raise NotImplementedError
    
    def process_data(self, data):
        raise NotImplementedError
    
    def export_data(self, data, target):
        raise NotImplementedError
```

### 2. 多数据源支持
```python
class DataSourceManager:
    """数据源管理器"""
    
    def __init__(self):
        self.sources = {
            'excel': ExcelSource(),
            'csv': CSVSource(),
            'json': JSONSource(),
            'database': DatabaseSource()
        }
    
    def get_source(self, source_type):
        return self.sources.get(source_type)
```

### 3. 可配置图表
```python
CHART_CONFIGS = {
    'line': {
        'type': 'line',
        'smooth': True,
        'symbol': 'circle'
    },
    'bar': {
        'type': 'bar',
        'barWidth': '60%'
    },
    'pie': {
        'type': 'pie',
        'radius': ['40%', '70%']
    }
}
```

---

*最后更新: 2026年2月21日*
*架构版本: v1.0*
*技术负责人: AI系统架构组*
